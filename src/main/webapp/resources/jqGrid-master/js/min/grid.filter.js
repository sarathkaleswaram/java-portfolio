(function(a){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./grid.common"],a):"object"===typeof exports?a(require("jquery")):a(jQuery)})(function(a){var m=a.jgrid;a.fn.jqFilter=function(k){if("string"===typeof k){var q=a.fn.jqFilter[k];if(!q)throw"jqFilter - No such method: "+k;var F=a.makeArray(arguments).slice(1);return q.apply(this,F)}var c=a.extend(!0,{filter:null,columns:[],onChange:null,afterRedraw:null,checkValues:null,error:!1,errmsg:"",errorcheck:!0,showQuery:!0,
sopt:null,ops:[],operands:null,numopts:"eq ne lt le gt ge nu nn in ni".split(" "),stropts:"eq ne bw bn ew en cn nc nu nn in ni".split(" "),strarr:["text","string","blob"],groupOps:[{op:"AND",text:"AND"},{op:"OR",text:"OR"}],groupButton:!0,ruleButtons:!0,direction:"ltr"},m.filter,k||{});return this.each(function(){if(!this.filter){this.p=c;if(null===c.filter||void 0===c.filter)c.filter={groupOp:c.groupOps[0].op,rules:[],groups:[]};var k,q=c.columns.length,e,C=/msie/i.test(navigator.userAgent)&&!window.opera,
w=function(){return a("#"+m.jqID(c.id))[0]||null},z=function(f){return a(w()).jqGrid("getGridRes","search."+f)},B=a(w()).jqGrid("getGuiStyles","states.error"),D=a(w()).jqGrid("getGuiStyles","dialog.content");c.initFilter=a.extend(!0,{},c.filter);if(q){for(k=0;k<q;k++)e=c.columns[k],e.stype?e.inputtype=e.stype:e.inputtype||(e.inputtype="text"),e.sorttype?e.searchtype=e.sorttype:e.searchtype||(e.searchtype="string"),void 0===e.hidden&&(e.hidden=!1),e.label||(e.label=e.name),e.index&&(e.name=e.index),
e.hasOwnProperty("searchoptions")||(e.searchoptions={}),e.hasOwnProperty("searchrules")||(e.searchrules={});c.showQuery&&a(this).append("<table class='queryresult "+D+"' style='display:block;max-width:440px;border:0px none;' dir='"+c.direction+"'><tbody><tr><td class='query'></td></tr></tbody></table>");var E=function(f,l){var b=[!0,""],g=w();if(a.isFunction(l.searchrules))b=l.searchrules.call(g,f,l);else if(m&&m.checkValues)try{b=m.checkValues.call(g,f,-1,l.searchrules,l.label)}catch(r){}b&&b.length&&
!1===b[0]&&(c.error=!b[0],c.errmsg=b[1])};this.onchange=function(){c.error=!1;c.errmsg="";return a.isFunction(c.onChange)?c.onChange.call(this,c):!1};this.reDraw=function(){a("table.group:first",this).remove();var f=this.createTableForGroup(c.filter,null);a(this).append(f);a.isFunction(c.afterRedraw)&&c.afterRedraw.call(this,c)};this.createTableForGroup=function(f,l){var b=this,g,r=a("<table class='group "+D+"' style='border:0px none;'><tbody></tbody></table>"),d="left";"rtl"===c.direction&&(d="right",
r.attr("dir","rtl"));null===l&&r.append("<tr class='error' style='display:none;'><th colspan='5' class='"+B+"' align='"+d+"'></th></tr>");var h=a("<tr></tr>");r.append(h);d=a("<th colspan='5' align='"+d+"'></th>");h.append(d);if(!0===c.ruleButtons){var k=a("<select class='opsel'></select>");d.append(k);var h="",e;for(g=0;g<c.groupOps.length;g++)e=f.groupOp===b.p.groupOps[g].op?" selected='selected'":"",h+="<option value='"+b.p.groupOps[g].op+"'"+e+">"+b.p.groupOps[g].text+"</option>";k.append(h).bind("change",
function(){f.groupOp=a(k).val();b.onchange()})}h="<span></span>";c.groupButton&&(h=a("<input type='button' value='+ {}' title='"+z("addGroupTitle")+"' class='add-group'/>"),h.bind("click",function(){void 0===f.groups&&(f.groups=[]);f.groups.push({groupOp:c.groupOps[0].op,rules:[],groups:[]});b.reDraw();b.onchange();return!1}));d.append(h);if(!0===c.ruleButtons){var h=a("<input type='button' value='+' title='"+z("addRuleTitle")+"' class='add-rule ui-add'/>"),m;h.bind("click",function(){var c,d,h;void 0===
f.rules&&(f.rules=[]);for(g=0;g<b.p.columns.length;g++)if(c=void 0===b.p.columns[g].search?!0:b.p.columns[g].search,d=!0===b.p.columns[g].hidden,(h=!0===b.p.columns[g].searchoptions.searchhidden)&&c||c&&!d){m=b.p.columns[g];break}c=m.searchoptions.sopt?m.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==a.inArray(m.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;f.rules.push({field:m.name,op:c[0],data:""});b.reDraw();return!1});d.append(h)}null!==l&&(h=a("<input type='button' value='-' title='"+z("deleteGroupTitle")+
"' class='delete-group'/>"),d.append(h),h.bind("click",function(){for(g=0;g<l.groups.length;g++)if(l.groups[g]===f){l.groups.splice(g,1);break}b.reDraw();b.onchange();return!1}));if(void 0!==f.groups)for(g=0;g<f.groups.length;g++)d=a("<tr></tr>"),r.append(d),h=a("<td class='first'></td>"),d.append(h),h=a("<td colspan='4'></td>"),h.append(this.createTableForGroup(f.groups[g],f)),d.append(h);void 0===f.groupOp&&(f.groupOp=b.p.groupOps[0].op);if(void 0!==f.rules)for(g=0;g<f.rules.length;g++)r.append(this.createTableRowForRule(f.rules[g],
f));return r};this.createTableRowForRule=function(f,l){var b=this,g=w(),k=a("<tr></tr>"),d,h,e,n="",t;k.append("<td class='first'></td>");var p=a("<td class='columns'></td>");k.append(p);var q=a("<select></select>"),v,u=[];p.append(q);q.bind("change",function(){f.field=a(q).val();var c=a(this).parents("tr:first"),d,l;for(l=0;l<b.p.columns.length;l++)if(b.p.columns[l].name===f.field){d=b.p.columns[l];break}if(d){var e=a.extend({},d.searchoptions||{},{id:m.randId(),name:d.name,mode:"search"});C&&"text"===
d.inputtype&&!e.size&&(e.size=10);var k=m.createEl.call(g,d.inputtype,e,"",!0,b.p.ajaxSelectOptions||{},!0);a(k).addClass("input-elm");h=e.sopt?e.sopt:b.p.sopt?b.p.sopt:-1!==a.inArray(d.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;d="";var r=0,n,p;u=[];a.each(b.p.ops,function(){u.push(this.oper)});b.p.cops&&a.each(b.p.cops,function(b){u.push(b)});for(l=0;l<h.length;l++)p=h[l],v=a.inArray(h[l],u),-1!==v&&(n=b.p.ops[v],n=void 0!==n?n.text:b.p.cops[p].text,0===r&&(f.op=p),d+="<option value='"+p+"'>"+
n+"</option>",r++);a(".selectopts",c).empty().append(d);a(".selectopts",c)[0].selectedIndex=0;m.msie&&9>m.msiever()&&(l=parseInt(a("select.selectopts",c)[0].offsetWidth,10)+1,a(".selectopts",c).width(l),a(".selectopts",c).css("width","auto"));a(".data",c).empty().append(k);m.bindEv.call(g,k,e);a(".input-elm",c).bind("change",function(d){d=d.target;f.data="SPAN"===d.nodeName.toUpperCase()&&e&&a.isFunction(e.custom_value)?e.custom_value.call(g,a(d).children(".customelement:first"),"get"):d.value;b.onchange()});
setTimeout(function(){f.data=a(k).val();b.onchange()},0)}});var p=0,x,y;for(d=0;d<b.p.columns.length;d++)if(t=void 0===b.p.columns[d].search?!0:b.p.columns[d].search,x=!0===b.p.columns[d].hidden,(y=!0===b.p.columns[d].searchoptions.searchhidden)&&t||t&&!x)t="",f.field===b.p.columns[d].name&&(t=" selected='selected'",p=d),n+="<option value='"+b.p.columns[d].name+"'"+t+">"+b.p.columns[d].label+"</option>";q.append(n);n=a("<td class='operators'></td>");k.append(n);e=c.columns[p];C&&"text"===e.inputtype&&
!e.searchoptions.size&&(e.searchoptions.size=10);p=m.createEl.call(g,e.inputtype,a.extend({},e.searchoptions||{},{id:m.randId(),name:e.name}),f.data,!0,b.p.ajaxSelectOptions||{},!0);if("nu"===f.op||"nn"===f.op)a(p).attr("readonly","true"),a(p).attr("disabled","true");var A=a("<select class='selectopts'></select>");n.append(A);A.bind("change",function(){f.op=a(A).val();var d=a(this).parents("tr:first"),d=a(".input-elm",d)[0];"nu"===f.op||"nn"===f.op?(f.data="","SELECT"!==d.tagName.toUpperCase()&&(d.value=
""),d.setAttribute("readonly","true"),d.setAttribute("disabled","true")):("SELECT"===d.tagName.toUpperCase()&&(f.data=d.value),d.removeAttribute("readonly"),d.removeAttribute("disabled"));b.onchange()});h=e.searchoptions.sopt?e.searchoptions.sopt:b.p.sopt?b.p.sopt:-1!==a.inArray(e.searchtype,b.p.strarr)?b.p.stropts:b.p.numopts;n="";a.each(b.p.ops,function(){u.push(this.oper)});b.p.cops&&a.each(b.p.cops,function(b){u.push(b)});for(d=0;d<h.length;d++)y=h[d],v=a.inArray(h[d],u),-1!==v&&(x=b.p.ops[v],
t=f.op===y?" selected='selected'":"",n+="<option value='"+y+"'"+t+">"+(void 0!==x?x.text:b.p.cops[y].text)+"</option>");A.append(n);n=a("<td class='data'></td>");k.append(n);n.append(p);m.bindEv.call(g,p,e.searchoptions);a(p).addClass("input-elm").bind("change",function(){f.data="custom"===e.inputtype?e.searchoptions.custom_value.call(g,a(this).children(".customelement:first"),"get"):a(this).val();b.onchange()});n=a("<td></td>");k.append(n);!0===c.ruleButtons&&(p=a("<input type='button' value='-' title='"+
z("deleteRuleTitle")+"' class='delete-rule ui-del'/>"),n.append(p),p.bind("click",function(){for(d=0;d<l.rules.length;d++)if(l.rules[d]===f){l.rules.splice(d,1);break}b.reDraw();b.onchange();return!1}));return k};this.getStringForGroup=function(a){var c="(",b;if(void 0!==a.groups)for(b=0;b<a.groups.length;b++){1<c.length&&(c+=" "+a.groupOp+" ");try{c+=this.getStringForGroup(a.groups[b])}catch(g){alert(g)}}if(void 0!==a.rules)try{for(b=0;b<a.rules.length;b++)1<c.length&&(c+=" "+a.groupOp+" "),c+=this.getStringForRule(a.rules[b])}catch(g){alert(g)}c+=
")";return"()"===c?"":c};this.getStringForRule=function(f){var e="",b="",g,k,d=f.data,h;for(g=0;g<c.ops.length;g++)if(c.ops[g].oper===f.op){e=c.operands.hasOwnProperty(f.op)?c.operands[f.op]:"";b=c.ops[g].oper;break}if(""===b&&null!=c.cops)for(h in c.cops)if(c.cops.hasOwnProperty(h)&&(b=h,e=c.cops[h].operand,a.isFunction(c.cops[h].buildQueryValue)))return c.cops[h].buildQueryValue.call(c,{cmName:f.field,searchValue:d,operand:e});for(g=0;g<c.columns.length;g++)if(c.columns[g].name===f.field){k=c.columns[g];
break}if(null==k)return"";if("bw"===b||"bn"===b)d+="%";if("ew"===b||"en"===b)d="%"+d;if("cn"===b||"nc"===b)d="%"+d+"%";if("in"===b||"ni"===b)d=" ("+d+")";c.errorcheck&&E(f.data,k);return-1!==a.inArray(k.searchtype,["int","integer","float","number","currency"])||"nn"===b||"nu"===b?f.field+" "+e+" "+d:f.field+" "+e+' "'+d+'"'};this.resetFilter=function(){c.filter=a.extend(!0,{},c.initFilter);this.reDraw();this.onchange()};this.hideError=function(){a("th."+B,this).html("");a("tr.error",this).hide()};
this.showError=function(){a("th."+B,this).html(c.errmsg);a("tr.error",this).show()};this.toUserFriendlyString=function(){return this.getStringForGroup(c.filter)};this.toString=function(){function a(b){var c="(",k;if(void 0!==b.groups)for(k=0;k<b.groups.length;k++)1<c.length&&(c="OR"===b.groupOp?c+" || ":c+" && "),c+=a(b.groups[k]);if(void 0!==b.rules)for(k=0;k<b.rules.length;k++){1<c.length&&(c="OR"===b.groupOp?c+" || ":c+" && ");var d=b.rules[k];if(e.p.errorcheck){for(var h=void 0,m=void 0,h=0;h<
e.p.columns.length;h++)if(e.p.columns[h].name===d.field){m=e.p.columns[h];break}m&&E(d.data,m)}c+=d.op+"(item."+d.field+",'"+d.data+"')"}c+=")";return"()"===c?"":c}var e=this;return a(c.filter)};this.reDraw();if(c.showQuery)this.onchange();this.filter=!0}}})};a.extend(a.fn.jqFilter,{toSQLString:function(){var a="";this.each(function(){a=this.toUserFriendlyString()});return a},filterData:function(){var a;this.each(function(){a=this.p.filter});return a},getParameter:function(a){return void 0!==a&&this.p.hasOwnProperty(a)?
this.p[a]:this.p},resetFilter:function(){return this.each(function(){this.resetFilter()})},addFilter:function(a){"string"===typeof a&&(a=m.parse(a));this.each(function(){this.p.filter=a;this.reDraw();this.onchange()})}})});
//# sourceMappingURL=grid.filter.map
